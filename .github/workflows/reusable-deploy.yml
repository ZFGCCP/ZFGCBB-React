on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
        description: "The environment to deploy to (e.g., main, development)"
      artifact_name:
        required: false
        type: string
        default: ""
        description: "The name of the artifact to deploy (if empty, will use environment-build)"
      preview:
        required: false
        type: boolean
        default: false
        description: "Whether to deploy as a preview"
    outputs:
      page_url:
        description: "The URL of the deployed page"
        value: ${{ jobs.deploy.outputs.page_url }}

permissions:
  pages: write
  id-token: write
  contents: read

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: ${{ inputs.environment }}
      url: ${{ steps.deployment.outputs.page_url }}
    outputs:
      page_url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Setup Pages
        uses: actions/configure-pages@v5
        with:
          enablement: true

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        with:
          artifact_name: ${{ inputs.artifact_name != '' && inputs.artifact_name || format('{0}-build', inputs.environment) }}
          preview: ${{ inputs.environment != 'production' }}
